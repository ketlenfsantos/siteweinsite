
      // --- MAPEAMENTOS GLOBAIS ---
      const sitePagesMap = {
        1: 'üè¢ Apresentar minha empresa ou marca',
        2: 'üõí Vender um Produto ou Servi√ßo',
        3: 'üì¢ Divulgar um Produto Espec√≠fico',
        4: 'üöÄ Lan√ßar um Produto ou Servi√ßo',
        5: 'üé® Expor meu trabalho ou projetos',
        6: '‚úçÔ∏è Criar um Blog de Conte√∫dos',
        7: '‚úçÔ∏è Quero expor meu trabalho no Google com uma p√°gina simples',
        8: '‚úçÔ∏è Quero captar leads',
      };

      const siteSolutionsMap = {
        'üè¢ Apresentar minha empresa ou marca': {
          titulo: 'Site Institucional ou One Page',
          explicacao:
            'Um Site √© a base da sua presen√ßa online. √â onde sua marca ganha autoridade, apresenta seus produtos ou servi√ßos com clareza e transmite confian√ßa ao p√∫blico. Uma ferramenta poderosa para criar confian√ßa e aparecer nos mecanismos de buscas de potenciais clientes.',
        },
        'üõí Vender um Produto ou Servi√ßo': {
          titulo: 'Landing Page - P√°gina de Vendas',
          explicacao:
            'A landing page √© uma p√°gina √∫nica e altamente focada em uma a√ß√£o espec√≠fica. Um p√°gina de vendas √© feita para transformar visitantes em clientes. Com foco total em destacar seu produto, remover obje√ß√µes e conduzir √† compra com alta convers√£o !',
        },
        'üì¢ Divulgar um Produto Espec√≠fico': {
          titulo: 'Landing Page - P√°gina de Lan√ßamento ou Vendas',
          explicacao:
            'A landing page √© uma p√°gina √∫nica e altamente focada em uma a√ß√£o espec√≠fica. √â o palco perfeito para divulgar um novo produto ou servi√ßo. Cria urg√™ncia, desejo e engajamento com timers, b√¥nus e gatilhos de escassez, com total em destacar seu produto, remover obje√ß√µes e conduzir √† compra com alta convers√£o',
        },
        'üöÄ Lan√ßar um Produto ou Servi√ßo': {
          titulo: 'Landing Page - P√°gina de Lan√ßamento',
          explicacao:
            'A landing page √© uma p√°gina √∫nica e altamente focada em uma a√ß√£o espec√≠fica. Esse tipo de p√°gina visa gerar expectativa, apresentar a novidade e, muitas vezes, coletar e-mails de interessados para nutrir leads antes, durante e ap√≥s o lan√ßamento oficial, construindo uma audi√™ncia engajada.',
        },
        'üé® Expor meu trabalho ou projetos': {
          titulo: 'Site Portf√≥lio',
          explicacao:
            'Um site portf√≥lio √© uma ferramenta essencial para profissionais de diversas √°reas, como designers, fot√≥grafos, escritores, desenvolvedores e artistas, que desejam exibir seus melhores trabalhos de forma organizada e acess√≠vel. Mais do que uma simples galeria de projetos, ele funciona como um cart√£o de visitas digital, permitindo que potenciais clientes, empregadores ou colaboradores conhe√ßam suas habilidades, estilo e experi√™ncia.',
        },
        '‚úçÔ∏è Criar um Blog de Conte√∫dos': {
          titulo: 'Blog Integrado ao Site',
          explicacao:
            'Se o foco √© marketing de conte√∫do e SEO, um Blog Integrado ao Site √© a solu√ß√£o. Permite publicar artigos, guias e not√≠cias relevantes para seu p√∫blico, aumentando o tr√°fego org√¢nico e posicionando sua marca como refer√™ncia.',
        },
        '‚úçÔ∏è Quero expor meu trabalho no Google com uma p√°gina simples': {
          titulo: 'Site One-Page (Site de P√°gina √önica)',
          explicacao:
            'Um Site √© a base da sua presen√ßa online. √â onde sua marca ganha autoridade, apresenta seus produtos ou servi√ßos com clareza e transmite confian√ßa ao p√∫blico. A One Page √© uma solu√ß√£o compacta e eficiente para apresentar informa√ß√µes de forma direta e concisa. Ao inv√©s de m√∫ltiplas p√°ginas com links de navega√ß√£o internos, todo o conte√∫do √© organizado em uma √∫nica p√°gina longa, que o usu√°rio pode rolar para baixo e acessar as principais informa√ß√µes. Servi√ßo ideal para quem est√° iniciando.',
        },
        '‚úçÔ∏è Quero captar Leads': {
          titulo: 'Landing Page - P√°gina de Captura de Leads',
          explicacao:
            'A landing page √© uma p√°gina √∫nica e altamente focada em uma a√ß√£o espec√≠fica. Empresas e profissionais que querem que o visitante realize uma a√ß√£o espec√≠fica e mensur√°vel, que vai al√©m da venda direta ou da captura de e-mails. Pode ser o download de um material, o preenchimento de um formul√°rio de or√ßamento, a solicita√ß√£o de uma demonstra√ß√£o, a inscri√ß√£o em um evento gratuito ou qualquer outra a√ß√£o que represente um passo adiante no funil de vendas',
        },
      };

      const redesSociaisMap = {
        1: 'üì± Preciso de posts personalizados para o meu feed do instagram',
        2: 'üñºÔ∏è Quero criar capas para meus stories e reels',
        3: '‚úçÔ∏è Preciso de ajuda para ajustar meu perfil',
        4: 'üìÖ Quero ajuda para planejar meu conte√∫do e legendas',
        5: 'üì¢Preciso de posts e que alguem poste para mim',
        6: 'üì¶ Tenho interesse em um pacote mensal de artes digitais',
        7: 'üíª Preciso de uma p√°gina personalizada de links para o instagram',
        8: '‚úçÔ∏è Todas op√ß√µes',
      };

      const socialSolutionsMap = {
        'üì± Preciso de posts personalizados para o meu feed do instagram': {
          titulo: 'Design Digital Personalizado para Instagram',
          explicacao:
            'Criamos pra voc√™, de acordo com a sua identidade visual, posts personalizados e exclusivos de acordo com o seu nicho. Voc√™ traz a ideia e n√≥s criamos. O foco em gerar engajamento e criar autoridade nas redes. Possu√≠mos diversas op√ß√µes atrativas que com certeza ir√£o te ajudar !',
        },
        'üñºÔ∏è Quero criar capas para meus stories e reels': {
          titulo: 'Design Digital Personalizado para Instagram',
          explicacao:
            'Criamos pra voc√™, de acordo com a sua identidade visual, posts personalizados e exclusivos de acordo com o seu nicho. Voc√™ traz a ideia e n√≥s criamos. O foco em gerar engajamento e criar autoridade nas redes. Possu√≠mos diversas op√ß√µes atrativas que v√£o te ajudar !',
        },
        '‚úçÔ∏è Preciso de ajuda para ajustar meu perfil': {
          titulo: 'Otimiza√ß√£o de Perfil de Redes Sociais',
          explicacao:
            'An√°lise e otimiza√ß√£o completa do seu perfil, incluindo bio, destaques e organiza√ß√£o, para atrair mais seguidores e clientes.',
        },
        'üìÖ Quero ajuda para planejar meu conte√∫do e legendas': {
          titulo: 'Planejamento Estrat√©gico de Conte√∫do',
          explicacao:
            'A op√ß√£o perfeita para ti que n√£o consegue ter ideias ou ser criativo. Te ajudamos a destravar no planejamento mensal de conte√∫do, ou seja, te ajudamos a pensar em uma estrat√©gia de acordo com seus objetivos e com o seu nicho. Criamos um calend√°rio de posts e postamos pra voc√™.',
        },
        'üì¢Preciso de posts e que alguem poste para mim': {
          titulo: 'Gest√£o de Conte√∫do e Publica√ß√£o',
          explicacao:
            'Nesse pacote, criamos um conte√∫do mensal b√°sico para suas redes. O diferencial √© que realizamos pra voc√™ a postagem nas suas redes, te auxiliamos na escolha de hor√°rios e voc√™ n√£o se preocupa. Al√©m disso, te ajudamos a estruturar o copywrite de suas postagens, de acordo com seu nicho e objetivos.',
        },
        'üì¶ Tenho interesse em um pacote mensal de artes digitais': {
          titulo: 'Pacote Mensal de Artes Digitais',
          explicacao:
            'Criamos pra voc√™, de acordo com a sua identidade visual, posts personalizados e exclusivos de acordo com o seu nicho. Voc√™ traz a ideia e n√≥s criamos. O foco em gerar engajamento e criar autoridade nas redes. Possu√≠mos diversas op√ß√µes atrativas que v√£o te ajudar !',
        },
        'üíª Preciso de uma p√°gina personalizada de links para o instagram': {
          titulo: 'P√°gina de Links Bio para o Instagram',
          explicacao:
            'A nova sensa√ß√£o do momento. Criamos pra voc√™ uma p√°gina totalmente personalizada e interativa, com imagens, cores que tenham a ver com o seu neg√≥cio. A porta de entrada do usu√°rio a todos os servi√ßos que voc√™ oferece de maneira interativa e facilitada.',
        },
        '‚úçÔ∏è Todas op√ß√µes': {
          titulo: 'Pacote Weinsite Start',
          explicacao:
            'Um pacote perfeito com absolutamente TUDO que voc√™ precisa para criar autoridade no Digital, desde o alinhamento do seu perfil, ao planejamento do seu conte√∫do. Envie o resultado deste formul√°rio que te enviaremos maiores detalhes',
        },
      };

      const stationeryMap = {
        cards: 'Cart√µes de visita',
        flyers: 'Flyers e panfletos',
        invitations: 'Convites digitais',
      };

      const stationerySolutionsMap = {
        'Cart√µes de visita': {
          titulo: 'Design digital de Cart√µes de Visita',
          explicacao:
            'Mesmo na era digital, o cart√£o de visita permanece como uma ferramenta de networking e marketing extremamente relevante e, em muitos casos, ideal. Ele transcende a tela do celular e oferece uma experi√™ncia t√°til e pessoal, importante para seu uso no dia a dia. Criamos para voc√™ o arquivo digital pronto para impress√£o ou para uso no Online.',
        },
        'Flyers e panfletos': {
          titulo: 'Design Digital de Flyers e Panfletos',
          explicacao:
            'Esses materiais impressos oferecem uma forma tang√≠vel de engajar o p√∫blico, seja com uma mensagem r√°pida e direta (flyer) ou com informa√ß√µes mais aprofundadas e organizadas (folder). Eles complementam a estrat√©gia digital e s√£o √≥timos para gerar leads e fortalecer o reconhecimento da marca no mundo f√≠sico. S√£o ferramentas de uso tanto no digital como no presencial',
        },
        'Convites digitais': {
          titulo: 'Design de Convites Digitais',
          explicacao:
            'Simplifique a organiza√ß√£o do seu evento e impressione seus convidados com convites digitais totalmente personalizados. Possu√≠mos op√ß√µes desde Convite Virtuais est√°ticos e din√¢micos, al√©m de Save the Dates e kits digitais para o seu evento. Saiba mais enviando esta resposta ! ',
        },
      };

      const logoMap = {
        basic: 'Ideias e inspira√ß√µes j√° possuo',
        intermediate: 'Preciso de inspira√ß√µes e ideias',
      };

      const logoSolutionsMap = {
        'Ideias e inspira√ß√µes j√° possuo': {
          titulo: 'Identidade Visual Basic',
          explicacao:
            'Fazer uma identidade visual √© muito mais do que ter um logotipo bonito. √â uma estrat√©gia fundamental para o reconhecimento, diferencia√ß√£o no mercado e constru√ß√£o de confian√ßa e credibilidade do seu neg√≥cio. Aqui na Weinsite, nosso foco √© proporcionar a quem est√° come√ßando no digital uma identidade visual completa, com tudo que voc√™ precisa. Clique no bot√£o a baixo que te enviamos as informa√ß√µes completas !',
        },
        'Preciso de inspira√ß√µes e ideias': {
          titulo: 'Identidade Visual Basic',
          explicacao:
            'Fazer uma identidade visual √© muito mais do que ter um logotipo bonito. √â uma estrat√©gia fundamental para o reconhecimento, diferencia√ß√£o no mercado e constru√ß√£o de confian√ßa e credibilidade do seu neg√≥cio. Aqui na Weinsite, nosso foco √© proporcionar a quem est√° come√ßando no digital uma identidade visual completa, com tudo que voc√™ precisa. Clique no bot√£o a baixo que te enviamos as informa√ß√µes completas ! ',
        },
      };

      const categoriasTexto = {
        site: 'Apresentar minha empresa no digital',
        logo: 'Criar uma identidade visual',
        social: 'Quero crescer nas redes sociais',
        stationery: 'Quero itens de papelaria digital',
      };

      // --- FUN√á√ÉO AUXILIAR para traduzir op√ß√µes ---
      function traduzirOpcoesParaArmazenar(categoria, valores) {
        if (!valores) return [];
        if (!Array.isArray(valores)) valores = [valores];

        let map = {};
        switch (categoria) {
          case 'site':
            map = sitePagesMap;
            break;
          case 'social':
            map = redesSociaisMap;
            break;
          case 'stationery':
            map = stationeryMap;
            break;
          case 'logo':
            map = logoMap;
            break;
          default:
            map = {};
        }
        return valores.map((v) => map[v] || v);
      }

      // --- L√ìGICA DO DOM E EVENT LISTENERS ---
      document.addEventListener('DOMContentLoaded', () => {

         // Anima√ß√£o com Intersection Observer
  const items = document.querySelectorAll("[data-anime]");
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add("anime");
      } else {
        entry.target.classList.remove("anime");
      }
    });
  }, {
    threshold: 0.2
  });
  items.forEach(item => observer.observe(item));

  
        const welcome = document.getElementById('welcome-screen');
        const formContainer = document.getElementById('form-container');
        const startBtn = document.getElementById('start-btn');

        // Inicializa√ß√£o dos elementos do formul√°rio
        const steps = Array.from(document.querySelectorAll('.form-step'));
        const form = document.getElementById('quote-form');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const submitBtn = document.getElementById('submit-btn');
        const progressBar = document.getElementById('progress-bar');
        const stepTitle = document.getElementById('step-title');
        const stepDescription = document.getElementById('step-description');

        // Mapeamento de t√≠tulos e descri√ß√µes para cada passo
        const titles = {
          'step-1': {
            title: 'Vamos nos conhecer?',
            desc: 'Preencha suas informa√ß√µes de contato',
          },
          'step-inicio': {
            title: 'Voc√™ est√° come√ßando agora?',
            desc: 'Entender isso nos ajuda a montar a proposta ideal para voc√™.',
          },
          'step-2': {
            title: 'Qual servi√ßo voc√™ precisa?',
            desc: 'Selecione a √°rea que melhor representa sua necessidade. A partir disso, vamos personalizar as pr√≥ximas perguntas',
          },
          'step-site': {
            title: 'Qual seu objetivo?',
            desc: 'A partir dessa informa√ß√£o consigo identificar o servi√ßo ideal pra voc√™',
          },
          'step-logo': {
            title: 'Sobre a sua Identidade Visual',
            desc: 'Que vai promover a autoridade e marca registrada do seu neg√≥cio',
          },
          'step-stationery': {
            title: 'Produtos Digitais para Papelaria',
            desc: 'Transformamos sua ideia em realidade no digital, confeccionamos produtos que podem ser impressos ou usados no digital',
          },
          'step-social': {
            title: 'Produtos Digitais para Redes Sociais',
            desc: 'Invista seu tempo no que realmente importa, deixe o processo criativo pra gente',
          },
          'step-social2': {
            title: 'Identidade Visual e Design',
            desc: 'Para estruturar o design do seu produto escolhido √© preciso ter uma identidade visual como logotipo, cores, tipografia',
          },
          'copy-write': {
            title: 'Conte√∫do da P√°gina',
            desc: 'Para um site dar os resultados esperados, √© preciso ter um conte√∫do estrat√©gico, desde a parte visual (banners, imagens) como a parte escrita(Copywrite)',
          },
        };

        // Define o caminho padr√£o inicial.
        let stepPath = ['step-1', 'step-inicio', 'step-2'];
        let currentStepIndex = 0; // Sempre come√ßa em 0

        // Fun√ß√£o para atualizar a interface do usu√°rio (exibir/esconder passos, bot√µes, progresso)
        const updateUI = () => {
          console.log('--- updateUI chamado ---');
          console.log('currentStepIndex DENTRO DO updateUI:', currentStepIndex);
          console.log('stepPath DENTRO DO updateUI:', stepPath);
          console.log('stepPath.length DENTRO DO updateUI:', stepPath.length); // Adicione esta linha!

          const stepId = stepPath[currentStepIndex];
          steps.forEach((s) => s.classList.toggle('active', s.id === stepId)); // Ativa o passo atual

          const { title, desc } = titles[stepId] || {};
          stepTitle.textContent = title || '';
          stepDescription.textContent = desc || '';

          prevBtn.disabled = currentStepIndex === 0; // Desabilita "Anterior" no primeiro passo
          // A L√ìGICA CR√çTICA DOS BOT√ïES: Corrigida para garantir o comportamento no step-2.

          // Calculamos se √© o √∫ltimo passo no caminho atual.

          const isLastStepCalculated = currentStepIndex === stepPath.length - 1;

          let shouldShowNextBtn = true; // Por padr√£o, mostra "Pr√≥ximo"

          let shouldShowSubmitBtn = false; // Por padr√£o, esconde "Gerar Or√ßamento"

          if (stepId === 'step-2') {
            // No step-2, o "Pr√≥ximo" DEVE SEMPRE APARECER, e o "Gerar Or√ßamento" DEVE ESTAR ESCONDIDO.

            // Isso ignora o 'isLastStepCalculated' para este passo espec√≠fico.

            shouldShowNextBtn = true; // For√ßa "Pr√≥ximo" a ser vis√≠vel

            shouldShowSubmitBtn = false; // For√ßa "Gerar Or√ßamento" a ser escondido

            console.log(
              'L√≥gica de bot√£o OVERRIDE para step-2: Pr√≥ximo vis√≠vel, Gerar Or√ßamento escondido.',
            );
          } else {
            // Para todos os outros passos, a l√≥gica normal de √∫ltimo passo se aplica.

            shouldShowNextBtn = !isLastStepCalculated;

            shouldShowSubmitBtn = isLastStepCalculated;

            console.log(
              `L√≥gica de bot√£o NORMAL para ${stepId}: isLastStepCalculated = ${isLastStepCalculated}`,
            );
          }

          nextBtn.classList.toggle('hidden', !shouldShowNextBtn);

          submitBtn.classList.toggle('hidden', !shouldShowSubmitBtn);

          const progress = ((currentStepIndex + 1) / stepPath.length) * 100;
          progressBar.style.width = `${progress}%`;

          console.log(
            'Bot√£o Pr√≥ximo escondido:',
            nextBtn.classList.contains('hidden'),
          );
          console.log(
            'Bot√£o Gerar Or√ßamento escondido:',
            submitBtn.classList.contains('hidden'),
          );
          console.log('isLastStepCalculated:', isLastStepCalculated);
          console.log('Tamanho do stepPath:', stepPath.length);
          console.log('ID do passo atual:', stepId);
        };

        // Fun√ß√£o de valida√ß√£o dos campos obrigat√≥rios do passo atual
        const validateStep = () => {
          const currentStepId = stepPath[currentStepIndex];
          const currentStepElement = document.getElementById(currentStepId);
          if (!currentStepElement) {
            console.error(
              `Passo atual com ID "${currentStepId}" n√£o encontrado.`,
            );
            return false;
          }
          const requiredFields = currentStepElement.querySelectorAll(
            'input[required], select[required], textarea[required]',
          );

          for (let field of requiredFields) {
            if (field.type === 'radio') {
              const radios = currentStepElement.querySelectorAll(
                `input[name="${field.name}"][required]`,
              );
              if (![...radios].some((r) => r.checked)) {
                alert('Selecione uma op√ß√£o para continuar.');
                console.log(`Valida√ß√£o falhou para r√°dio: ${field.name}`);
                return false;
              }
            } else if (field.type === 'checkbox') {
              const checkboxes = currentStepElement.querySelectorAll(
                `input[name="${field.name}"][required]`,
              );
              if (![...checkboxes].some((cb) => cb.checked)) {
                alert('Selecione pelo menos uma op√ß√£o para continuar.');
                console.log(`Valida√ß√£o falhou para checkbox: ${field.name}`);
                return false;
              }
            } else if (!field.value.trim()) {
              alert('Preencha todos os campos obrigat√≥rios.');
              console.log(
                `Valida√ß√£o falhou para campo vazio: ${field.id || field.name}`,
              );
              return false;
            }
          }
          console.log('Valida√ß√£o bem-sucedida para o passo:', currentStepId);
          return true;
        };

        // --- EVENT LISTENERS ---

        // Bot√£o "Come√ßar" na tela de boas-vindas
        if (startBtn && welcome && formContainer) {
          startBtn.addEventListener('click', () => {
            const acceptTerms = document.getElementById('accept-terms');
            if (acceptTerms && !acceptTerms.checked) {
              alert(
                'Por favor, aceite os Termos de Servi√ßo e a Pol√≠tica de Privacidade antes de continuar.',
              );
              return;
            }
            welcome.classList.add('hidden');
            formContainer.classList.remove('hidden');
            // Ao iniciar o formul√°rio, GARANTIMOS que estamos no primeiro passo do caminho padr√£o
            currentStepIndex = 0;
            stepPath = ['step-1', 'step-inicio', 'step-2']; // Garante o path inicial
            updateUI(); // Exibe o primeiro passo
            console.log(
              'Formul√°rio iniciado. Passo atual:',
              stepPath[currentStepIndex],
            );
          });
        } else {
          console.error('Elementos da tela de boas-vindas n√£o encontrados.');
        }

        // Bot√£o "Pr√≥ximo"
        nextBtn.addEventListener('click', () => {
          console.log(
            'Clique em Pr√≥ximo. currentStepIndex ANTES:',
            currentStepIndex,
          );
          console.log('stepPath ANTES:', stepPath);

          if (!validateStep()) {
            console.log('Valida√ß√£o falhou, n√£o avan√ßa.');
            return;
          }

          const currentStepId = stepPath[currentStepIndex];

          // L√ìGICA CR√çTICA: Se estamos no 'step-2' (sele√ß√£o da categoria), reconstru√≠mos o stepPath E AVAN√áAMOS
          if (currentStepId === 'step-2') {
            const selectedService = form.querySelector(
              'input[name="service"]:checked',
            )?.value;
            console.log('*** NOVO stepPath AP√ìS SELE√á√ÉO DE SERVI√áO:', stepPath);
            console.log(
              '*** currentStepIndex AP√ìS AVAN√áAR NO DYN_PATH:',
              currentStepIndex,
            );

            if (!selectedService) {
              // Valida√ß√£o extra para garantir que algo foi selecionado
              alert(
                'Por favor, selecione uma categoria de servi√ßo para continuar.',
              );
              return;
            }

            let newStepPath = ['step-1', 'step-inicio', 'step-2']; // Base do caminho

            // Adiciona os passos espec√≠ficos da categoria selecionada ao caminho
            if (selectedService === 'site') {
              newStepPath.push('step-site', 'step-social2', 'copy-write');
            } else if (selectedService === 'social') {
              newStepPath.push('step-social', 'step-social2', 'copy-write');
            } else if (selectedService === 'stationery') {
              newStepPath.push('step-stationery', 'step-social2', 'copy-write');
            } else if (selectedService === 'logo') {
              newStepPath.push('step-logo', 'copy-write'); // Logo n√£o tem 'step-social2'
            }

            stepPath = newStepPath; // Atualiza o stepPath GLOBAL aqui
            console.log(
              '*** ATUALIZA√á√ÉO CR√çTICA DO stepPath PARA FLUXO ESPEC√çFICO (AP√ìS SELE√á√ÉO NO STEP-2) ***',
            );
            console.log('stepPath AGORA √â:', stepPath);

            // AGORA QUE O stepPath EST√Å COMPLETO, PODEMOS AVAN√áAR O √çNDICE E CHAMAR updateUI
            currentStepIndex++;
            console.log(
              'currentStepIndex DEPOIS DE AVAN√áAR NO FLUXO ESPEC√çFICO:',
              currentStepIndex,
            );
            updateUI(); // Chama updateUI para renderizar o NOVO passo com o stepPath correto
            return; // Retorna para evitar que o c√≥digo continue e chame updateUI novamente
          }

          if (currentStepIndex < stepPath.length - 1) {
            currentStepIndex++;
            console.log(
              'currentStepIndex AP√ìS AVAN√áAR NO GENERIC_PATH:',
              currentStepIndex,
            );
            updateUI(); // Chama updateUI normalmente para atualizar o progresso e a UI
          } else {
            // L√≥gica para o √∫ltimo passo (provavelmente onde o bot√£o vira "Gerar Or√ßamento" ou similar)
            console.log(
              '√öltimo passo atingido. Pr√≥ximo clique deve ser para submeter.',
            );
          }
        });

        // Bot√£o "Anterior"
        prevBtn.addEventListener('click', () => {
          console.log(
            'Clique em Anterior. currentStepIndex ANTES:',
            currentStepIndex,
          );
          console.log('stepPath ANTES:', stepPath);

          if (currentStepIndex > 0) {
            currentStepIndex--;
            // Se ao voltar, chegarmos no 'step-2', resetamos o stepPath para o estado inicial
            // Isso √© crucial para que, ao avan√ßar novamente do step-2, o caminho seja recalculado.
            if (stepPath[currentStepIndex] === 'step-2') {
              stepPath = ['step-1', 'step-inicio', 'step-2'];
              console.log('Retornou ao step-2, stepPath resetado:', stepPath);
            }
            console.log('currentStepIndex DEPOIS:', currentStepIndex);
            updateUI();
          }
        });

        // Adiciona classe 'active' para visualiza√ß√£o da sele√ß√£o de r√°dio/checkbox
        document
          .querySelectorAll(
            'input[name="inicioDigital"], input[name="service"]',
          )
          .forEach((input) => {
            input.addEventListener('change', () => {
              const inputName = input.name;
              document
                .querySelectorAll(`input[name="${inputName}"]`)
                .forEach((i) => {
                  if (i.parentElement) {
                    i.parentElement.classList.remove('active');
                  }
                });
              if (input.checked && input.parentElement) {
                input.parentElement.classList.add('active');
              }
            });
          });

        // --- SUBMISS√ÉO DO FORMUL√ÅRIO (Bot√£o "Gerar Or√ßamento") ---
        form.addEventListener('submit', (e) => {
          e.preventDefault(); // impede o envio imediato
          console.log('Formul√°rio submetido.');

          // √öltima valida√ß√£o, embora o bot√£o s√≥ apare√ßa se o passo atual j√° foi validado
          if (!validateStep()) {
            console.error('Submiss√£o bloqueada: valida√ß√£o final falhou.');
            return;
          }

          const formData = new FormData(form);
          const data = {};

          formData.forEach((value, key) => {
            if (key.endsWith('[]')) {
              const cleanKey = key.slice(0, -2);
              if (!data[cleanKey]) {
                data[cleanKey] = [];
              }
              data[cleanKey].push(value);
            } else {
              data[key] = value;
            }
          });

          // --- Processamento de Vari√°veis para o Objeto 'orcamento' ---
          const categoriaRaw = data.service;
          const categoriaTraduzida =
            categoriasTexto[categoriaRaw] || categoriaRaw || '-';

          let solucaoIdealObj = { titulo: '', explicacao: '' };

          if (categoriaRaw === 'site') {
            const siteObjectivesRaw = data.site_pages || [];
            const objectivesToProcess = Array.isArray(siteObjectivesRaw)
              ? siteObjectivesRaw
              : [siteObjectivesRaw];

            if (objectivesToProcess.length > 0) {
              const selectedSiteObjectives = objectivesToProcess.map(
                (value) => sitePagesMap[value],
              );

              if (selectedSiteObjectives.includes(sitePagesMap[8])) {
                solucaoIdealObj = siteSolutionsMap[sitePagesMap[8]];
              } else if (selectedSiteObjectives.length === 1) {
                solucaoIdealObj = siteSolutionsMap[selectedSiteObjectives[0]];
              } else {
                let titulosCombinados = [];
                let explicacoesCombinadas = [];
                selectedSiteObjectives.forEach((objective) => {
                  const solution = siteSolutionsMap[objective];
                  if (solution) {
                    titulosCombinados.push(solution.titulo);
                    explicacoesCombinadas.push(solution.explicacao);
                  }
                });
                solucaoIdealObj.titulo =
                  'Solu√ß√µes Combinadas: ' + titulosCombinados.join(', ');
                solucaoIdealObj.explicacao = explicacoesCombinadas.join('\n\n');
              }
            }
          } else if (categoriaRaw === 'social') {
            const socialOptionsRaw = data.social_options || [];
            const optionsToProcess = Array.isArray(socialOptionsRaw)
              ? socialOptionsRaw
              : [socialOptionsRaw];

            if (optionsToProcess.length > 0) {
              const selectedSocialOptions = optionsToProcess.map(
                (value) => redesSociaisMap[value],
              );
              if (selectedSocialOptions.includes(redesSociaisMap[8])) {
                solucaoIdealObj = socialSolutionsMap[redesSociaisMap[8]];
              } else if (selectedSocialOptions.length === 1) {
                solucaoIdealObj = socialSolutionsMap[selectedSocialOptions[0]];
              } else {
                let titulosCombinados = [];
                let explicacoesCombinadas = [];
                selectedSocialOptions.forEach((option) => {
                  const solution = socialSolutionsMap[option];
                  if (solution) {
                    titulosCombinados.push(solution.titulo);
                    explicacoesCombinadas.push(solution.explicacao);
                  }
                });
                solucaoIdealObj.titulo =
                  'Solu√ß√µes de Redes Sociais Combinadas: ' +
                  titulosCombinados.join(', ');
                solucaoIdealObj.explicacao = explicacoesCombinadas.join('\n\n');
              }
            }
          } else if (categoriaRaw === 'stationery') {
            const stationeryOptionRaw = data.stationery_options;
            if (stationeryOptionRaw) {
              const selectedStationeryOption =
                stationeryMap[stationeryOptionRaw];
              if (
                selectedStationeryOption &&
                stationerySolutionsMap[selectedStationeryOption]
              ) {
                solucaoIdealObj =
                  stationerySolutionsMap[selectedStationeryOption];
              }
            }
          } else if (categoriaRaw === 'logo') {
            const logoPackageRaw = data.logo_package;
            if (logoPackageRaw) {
              const selectedLogoOption = logoMap[logoPackageRaw];
              if (selectedLogoOption && logoSolutionsMap[selectedLogoOption]) {
                solucaoIdealObj = logoSolutionsMap[selectedLogoOption];
              }
            }
          }

          const orcamento = {
            contato: {
              nome: data.name || '',
              email: data.email || '',
              whatsapp: data.whatsapp || '',
              negocio: data.negocio || '',
              tempoNegocio: data.tempoNegocio || '',
            },
            servico: {
              categoria: categoriaTraduzida,
              categoriaRaw: categoriaRaw,

              objetivoSiteRaw: data.site_pages || [],
              objetivoSiteTraduzido:
                categoriaRaw === 'site'
                  ? traduzirOpcoesParaArmazenar('site', data.site_pages)
                  : [],
              solucaoIdealSite:
                categoriaRaw === 'site' ? solucaoIdealObj : null,

              logoInsp: data.logo_package || '',
              logoInspTraduzido:
                categoriaRaw === 'logo'
                  ? traduzirOpcoesParaArmazenar('logo', data.logo_package)[0]
                  : '',
              solucaoIdealLogo:
                categoriaRaw === 'logo' ? solucaoIdealObj : null,

              socialNecessidadeRaw: data.social_options || [],
              socialNecessidadeTraduzida:
                categoriaRaw === 'social'
                  ? traduzirOpcoesParaArmazenar('social', data.social_options)
                  : [],
              socialIdentidade:
                data.has_identity === 'yes'
                  ? 'Sim, j√° possuo Identidade Visual'
                  : data.has_identity === 'no'
                  ? 'N√£o, precisarei de ajuda para criar uma Identidade Visual'
                  : 'N√£o informado',
              solucaoIdealSocial:
                categoriaRaw === 'social' ? solucaoIdealObj : null,

              papelariaRaw: data.stationery_options || '',
              papelariaTraduzida:
                categoriaRaw === 'stationery'
                  ? traduzirOpcoesParaArmazenar(
                      'stationery',
                      data.stationery_options,
                    )[0]
                  : '',
              solucaoIdealStationery:
                categoriaRaw === 'stationery' ? solucaoIdealObj : null,

              copywrite:
                data.has_identity_copywrite === 'yes'
                  ? 'Sim, j√° possuo Copywrite'
                  : data.has_identity_copywrite === 'no'
                  ? 'N√£o, precisarei de ajuda para criar toda escrita e conte√∫do.'
                  : 'N√£o informado',
              inicioDigital: data.inicioDigital || 'nao_informado',
            },
          };

          // Exibe o loader com o GIF
          document.getElementById('loader').classList.remove('hidden');
          setTimeout(() => {
            window.location.href = 'modelo-pdf.html'; // ou a p√°gina final
          }, 1500);

          localStorage.setItem('orcamento', JSON.stringify(orcamento));

          fetch('http://localhost:3001/api/leads', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              orcamento,
              data_envio: new Date().toISOString(),
            }),
          })
            .then(() => {
              window.location.href = 'modelo-pdf.html';
            })
            .catch((err) => {
              console.error('Erro ao enviar lead:', err);
              window.location.href = 'modelo-pdf.html'; // redireciona mesmo assim
            });
        });
      });
    